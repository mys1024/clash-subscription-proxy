import type { ClashProfile, ClashProxyGroup } from "../../types.ts";
import { yaml } from "../../deps.ts";

export default function (yamlProfile: string): string {
  const profile = yaml.parse(yamlProfile) as ClashProfile;

  // names of all raw proxies
  const rawProxies = profile.proxies.map((p) => p.name).sort();

  // region proxy groups
  const regionProxyGroups = [
    {
      name: "­ЪїЈ­ЪЄГ­ЪЄ░|ждЎТИ»",
      type: "url-test",
      proxies: rawProxies.filter((name) => /(ждЎТИ»|ТИ»тї║|ТИ»ТюЇ|Т▓фТИ»)/.test(name)),
      url: "http://www.gstatic.com/generate_204",
      interval: 300,
    },
    {
      name: "­ЪїЈ­ЪЄ╣­ЪЄ╝|тЈ░Т╣Й",
      type: "url-test",
      proxies: rawProxies.filter((name) => /(тЈ░Т╣Й|тЈ░тї║|тЈ░ТюЇ)/.test(name)),
      url: "http://www.gstatic.com/generate_204",
      interval: 600,
    },
    {
      name: "­ЪїЈ­ЪЄ»­ЪЄх|ТЌЦТюг",
      type: "url-test",
      proxies: rawProxies.filter((name) => /(ТЌЦТюг|ТЌЦтї║|ТЌЦТюЇ|СИГТЌЦ)/.test(name)),
      url: "http://www.gstatic.com/generate_204",
      interval: 600,
    },
    {
      name: "­ЪїЈ­ЪЄИ­ЪЄг|Тќ░тіатЮА",
      type: "url-test",
      proxies: rawProxies.filter((name) => /(Тќ░тіатЮА)/.test(name)),
      url: "http://www.gstatic.com/generate_204",
      interval: 1200,
    },
    {
      name: "­ЪїЈ­ЪЄ║­ЪЄИ|уЙјтЏй",
      type: "url-test",
      proxies: rawProxies.filter((name) => /(уЙјтЏй|уЙјтї║|уЙјТюЇ|СИГуЙј)/.test(name)),
      url: "http://www.gstatic.com/generate_204",
      interval: 1200,
    },
  ];

  // completed proxy groups
  const completedProxies = [
    "DIRECT",
    "REJECT",
    ...regionProxyGroups.map((g) => g.name),
    ...rawProxies,
  ];
  const completedProxyGroups = [
    {
      name: "РџЊ|т«їтЁеA",
      type: "select",
      proxies: completedProxies,
    },
    {
      name: "РџЊ|т«їтЁеB",
      type: "select",
      proxies: completedProxies,
    },
  ];

  // limited proxy groups
  const limitedProxies = [
    "DIRECT",
    "REJECT",
    ...completedProxyGroups.map((g) => g.name),
    ...regionProxyGroups.map((g) => g.name),
  ];
  const limitedProxyGroup: ClashProxyGroup[] = [
    {
      name: "­Ъџђ|тЊћтЊЕтЊћтЊЕ",
      type: "select",
      proxies: [],
    },
    {
      name: "­Ъџђ|ТЌЦТюгТхЂжЄЈ",
      type: "select",
      proxies: [],
    },
    {
      name: "­Ъџђ|тЏйтцќТхЂжЄЈ",
      type: "select",
      proxies: [],
    },
    {
      name: "­Ъџђ|тЏйтєЁТхЂжЄЈ",
      type: "select",
      proxies: [],
    },
    {
      name: "­Ъџђ|тЁХС╗ќТхЂжЄЈ",
      type: "select",
      proxies: [],
    },
  ];
  for (const group of limitedProxyGroup) {
    group.proxies = limitedProxies;
  }

  // merge region, completed and limited proxy groups as the full proxy group list
  profile["proxy-groups"] = [
    ...limitedProxyGroup,
    ...completedProxyGroups,
    ...regionProxyGroups,
  ];

  // replace rules
  profile.rules = [
    // LAN
    "DOMAIN-SUFFIX,lan,DIRECT",
    "DOMAIN-SUFFIX,local,DIRECT",
    "IP-CIDR,127.0.0.0/8,DIRECT",
    "IP-CIDR,172.16.0.0/12,DIRECT",
    "IP-CIDR,192.168.0.0/16,DIRECT",
    "IP-CIDR,10.0.0.0/8,DIRECT",
    "IP-CIDR,17.0.0.0/8,DIRECT",
    "IP-CIDR,100.64.0.0/10,DIRECT",
    "IP-CIDR,224.0.0.0/4,DIRECT",
    "IP-CIDR6,::1/128,DIRECT",
    "IP-CIDR6,fe80::/10,DIRECT",
    "IP-CIDR6,fc00::/7,DIRECT",
    "IP-CIDR6,fd00::/8,DIRECT",
    // тЊћтЊЕтЊћтЊЕ
    "DOMAIN-SUFFIX,biliapi.com,тЊћтЊЕтЊћтЊЕ",
    "DOMAIN-SUFFIX,biliapi.net,тЊћтЊЕтЊћтЊЕ",
    "DOMAIN-SUFFIX,bilibili.com,тЊћтЊЕтЊћтЊЕ",
    "DOMAIN-SUFFIX,bilibili.tv,тЊћтЊЕтЊћтЊЕ",
    "DOMAIN-SUFFIX,bilivideo.com,тЊћтЊЕтЊћтЊЕ",
    // ТЌЦТюгТхЂжЄЈ
    "DOMAIN-SUFFIX,5ch.net,ТЌЦТюгТхЂжЄЈ",
    "DOMAIN-SUFFIX,dmm.co.jp,ТЌЦТюгТхЂжЄЈ",
    "DOMAIN-SUFFIX,dmm.com,ТЌЦТюгТхЂжЄЈ",
    "DOMAIN-SUFFIX,jp,ТЌЦТюгТхЂжЄЈ",
    "GEOIP,JP,ТЌЦТюгТхЂжЄЈ",
    // тЏйтцќТхЂжЄЈ
    "DOMAIN-KEYWORD,github,тЏйтцќТхЂжЄЈ",
    "DOMAIN-KEYWORD,amazon,тЏйтцќТхЂжЄЈ",
    "DOMAIN-KEYWORD,google,тЏйтцќТхЂжЄЈ",
    "DOMAIN-KEYWORD,gmail,тЏйтцќТхЂжЄЈ",
    "DOMAIN-KEYWORD,youtube,тЏйтцќТхЂжЄЈ",
    "DOMAIN-SUFFIX,wikiwand.com,тЏйтцќТхЂжЄЈ",
    "DOMAIN-SUFFIX,wikileaks.org,тЏйтцќТхЂжЄЈ",
    "DOMAIN-SUFFIX,wikimedia.org,тЏйтцќТхЂжЄЈ",
    "DOMAIN-SUFFIX,wikipedia.com,тЏйтцќТхЂжЄЈ",
    "DOMAIN-SUFFIX,wikipedia.org,тЏйтцќТхЂжЄЈ",
    // тЏйтєЁТхЂжЄЈ
    "DOMAIN-SUFFIX,mzstatic.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,itunes.apple.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,icloud.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,icloud-content.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,me.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,aaplimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cdn20.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cdn-apple.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,akadns.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,akamaiedge.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,edgekey.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,mwcloudcdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,mwcname.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,apple.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,apple-cloudkit.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,apple-mapkit.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,126.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,126.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,127.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,163.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,360buyimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,36kr.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,acfun.tv,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,air-matters.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,aixifan.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-KEYWORD,alicdn,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-KEYWORD,alipay,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-KEYWORD,taobao,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,amap.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,autonavi.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-KEYWORD,baidu,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,bdimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,bdstatic.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,bilibili.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,bilivideo.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,caiyunapp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,clouddn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cnbeta.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cnbetacdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cootekservice.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,csdn.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ctrip.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,dgtle.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,dianping.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,douban.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,doubanio.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,duokan.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,easou.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ele.me,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,feng.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,fir.im,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,frdic.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,g-cores.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,godic.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,gtimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN,cdn.hockeyapp.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,hongxiu.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,hxcdn.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,iciba.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ifeng.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ifengimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ipip.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,iqiyi.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,jd.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,jianshu.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,knewone.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,le.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,lecloud.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,lemicp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,licdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,luoo.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,meituan.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,meituan.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,mi.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,miaopai.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,microsoft.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,microsoftonline.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,miui.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,miwifi.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,mob.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,netease.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,office.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,office365.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-KEYWORD,officecdn,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,oschina.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ppsimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,pstatp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qcloud.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qdaily.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qdmm.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qhimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qhres.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qidian.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qihucdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qiniu.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qiniucdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qiyipic.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qq.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,qqurl.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,rarbg.to,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ruguoapp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,segmentfault.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,sinaapp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,smzdm.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,snapdrop.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,sogou.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,sogoucdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,sohu.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,soku.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,speedtest.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,sspai.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,suning.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,taobao.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,tencent.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,tenpay.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,tianyancha.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,tmall.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,tudou.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,umetrip.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,upaiyun.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,upyun.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,veryzhun.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,weather.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,weibo.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,xiami.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,xiami.net,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,xiaomicp.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ximalaya.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,xmcdn.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,xunlei.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,yhd.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,yihaodianimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,yinxiang.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,ykimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,youdao.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,youku.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,zealer.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,zhihu.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,zhimg.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,zimuzu.tv,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,zoho.com,тЏйтєЁТхЂжЄЈ",
    "DOMAIN-SUFFIX,cn,тЏйтєЁТхЂжЄЈ",
    "GEOIP,CN,тЏйтєЁТхЂжЄЈ",
    // тЁХС╗ќТхЂжЄЈ
    "MATCH,тЁХС╗ќТхЂжЄЈ",
  ];

  return yaml.stringify(profile);
}
